<!DOCTYPE html><html><head>
<style>
body {
    margin: 0;
    overflow: hidden;
}
#counter {
    position: absolute;
    width: 200px;
    height: 20px;
    color: white;
    text-align: center;
}
</style>
</head>
<body>
<script type="text/javascript" src="http://wow.techbrood.com/libs/jquery/jquery-2.1.1.min.js"></script><p id="counter"></p>
<script src="http://wow.techbrood.com/libs/threejs/r78/three.min.js"></script>

<script src="http://wow.techbrood.com/libs/threejs/r78/js/loaders/DDSLoader.js"></script>
<script src="http://wow.techbrood.com/libs/threejs/r78/js/loaders/OBJLoader.js"></script>
<script src="http://wow.techbrood.com/libs/threejs/r78/js/loaders/MTLLoader.js"></script>

<script src="http://wow.techbrood.com/libs/threejs/r78/js/Detector.js"></script>
<script src="http://wow.techbrood.com/libs/threejs/r78/js/libs/stats.min.js"></script>
<script type="text/javascript" src="js/TrackballControls.js" ></script>
<script>
var container, stats;
var camera, scene, renderer;
var mouseX = 0,
    mouseY = 0;
var windowHalfX = window.innerWidth / 2;
var windowHalfY = window.innerHeight / 2;

init();
animate();

function init() {

    container = document.createElement('div');
    document.body.appendChild(container);

    camera = new THREE.PerspectiveCamera(-10000, window.innerWidth / window.innerHeight, 1, 200000);
    //camera.position.z = ;
	//camera.position.y = 0.5;
	//camera.position.x = 1;
	camera.position.y = 10000;
	camera.position.x = 10000;
	camera.position.z = 10000;
    // scene
    //camera.setViewOffset( windowHalfX, windowHalfY, windowHalfX, windowHalfY, windowHalfX, windowHalfY );
    //camera.rotateZ = 45;
    scene = new THREE.Scene();

    var ambient = new THREE.AmbientLight(0x444444);
    scene.add(ambient);

    var directionalLight = new THREE.DirectionalLight(0xffeedd);
    directionalLight.position.set(0, 1, 1).normalize();
    scene.add(directionalLight);

    // model
    var onProgress = function(xhr) {
        if (xhr.lengthComputable) {
            var percentComplete = xhr.loaded / xhr.total * 100;
            var counter = document.getElementById("counter");
            counter.innerText = Math.round(percentComplete, 2) + '% downloaded';
        }
    };

    var onError = function(xhr) {};

    var mtlLoader = new THREE.MTLLoader();
    //mtlLoader.setPath('http://wow.techbrood.com/uploads/160601/obj/');
    mtlLoader.setPath('./res/');
    mtlLoader.load('floor1.mtl', function(materials) {

        materials.preload();

        var objLoader = new THREE.OBJLoader();
        objLoader.setMaterials(materials);
        objLoader.setPath('./res/');
        objLoader.load('floor1.obj', function(object) {
        	//object.position.y = -100;
            /*object.position.y = -1000;
            object.position.z = -8000;
            object.position.x = -10000;*/
            scene.add(object);

        }, onProgress, onError);

    });

    //

    renderer = new THREE.WebGLRenderer();
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    //
    
    //var controls = new THREE.OrbitControls( camera, renderer.domElement );
	/*controls.minDistance = 1;
	controls.maxDistance = 25;*/
	controls = new THREE.TrackballControls(camera, renderer.domElement);
    //window.addEventListener('resize', onWindowResize, false);

}

/*function onWindowResize() {

    windowHalfX = window.innerWidth / 2;
    windowHalfY = window.innerHeight / 2;

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);



}*/

var raycaster = new THREE.Raycaster();//光线投射，用于确定鼠标点击位置
var mouse = new THREE.Vector2();//创建二维平面
document.addEventListener("click",mousedown);//页面绑定鼠标点击事件
//点击方法
function mousedown(e){
    //将html坐标系转化为webgl坐标系，并确定鼠标点击位置
    mouse.x =  e.clientX / renderer.domElement.clientWidth*2-1;
    mouse.y =  -(e.clientY / renderer.domElement.clientHeight*2)+1;
    //以camera为z坐标，确定所点击物体的3D空间位置
    raycaster.setFromCamera(mouse,camera);
    //确定所点击位置上的物体数量
    var intersects = raycaster.intersectObjects(scene.children[2].children);
    //选中后进行的操作
    /*for(var i = 0; i < intersects.length; i++){
        console.log(e);
        intersects[ i ].object.material.color.set( 0xffffff );
       console.log(intersects[ i ]);
    }*/
    if(intersects.length){
    	console.log(intersects[0].object.name);
    	switch(intersects[0].object.name){
    		case 'ipc01':{
    			//intersects[ 0 ].object.material.color.set( 0xffffff )
    		}
    			
    		
    	}
    }
    renderer.render( scene, camera );
}


function animate() {

    requestAnimationFrame(animate);
    render();

}

function render() {


    //camera.lookAt(scene.position);
    if (renderer.autoClear) renderer.clear();

	controls.update();

    renderer.render(scene, camera);

}
</script>

</body>
</html>